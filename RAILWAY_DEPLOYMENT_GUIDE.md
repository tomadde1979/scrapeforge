# Railway Deployment Guide

## âœ… Railway-Ready Full-Stack App

Your full-stack Vite + Express app is now configured for Railway deployment with automatic frontend building and proper static file serving.

### ğŸ“ Project Structure
```
/
â”œâ”€â”€ package-heroku.json       # Railway deployment package.json
â”œâ”€â”€ railway.toml             # Railway configuration
â”œâ”€â”€ server/
â”‚   â””â”€â”€ index.cjs           # Express server with static serving + SPA routing
â”œâ”€â”€ client/                 # React + Vite app
â”‚   â”œâ”€â”€ dist/              # Built files (auto-generated by Railway)
â”‚   â””â”€â”€ vite.config.js     # Optimized build configuration
â””â”€â”€ RAILWAY_DEPLOYMENT_GUIDE.md
```

### ğŸš€ Key Configuration Changes

#### 1. Root package.json (package-heroku.json)
```json
{
  "scripts": {
    "postinstall": "cd client && npm install && npm run build",
    "start": "node server/index.cjs"
  }
}
```

#### 2. Express Server (server/index.cjs)
```javascript
const clientDistPath = path.join(__dirname, '../client/dist');

// Static file serving
app.use(express.static(clientDistPath));

// SPA routing fallback
app.get('*', (req, res) => {
  if (req.path.startsWith('/api')) {
    return res.status(404).json({ message: 'API endpoint not found' });
  }
  res.sendFile(path.join(clientDistPath, 'index.html'));
});
```

#### 3. Railway Configuration (railway.toml)
```toml
[deploy]
startCommand = "npm start"
healthcheckPath = "/api/health"

[env]
NODE_ENV = "production"
```

### ğŸ”„ Railway Deployment Process

1. **Copy deployment package.json**:
   ```bash
   cp package-heroku.json package.json
   ```

2. **Deploy to Railway**:
   - Connect your GitHub repository to Railway
   - Railway automatically:
     - Runs `npm install` (installs root dependencies)
     - Runs `postinstall` script: `cd client && npm install && npm run build`
     - Starts app: `node server/index.cjs`

3. **What happens during deployment**:
   ```
   1. Railway installs root dependencies (express)
   2. postinstall runs: builds React app to client/dist/
   3. Express server starts and serves built files
   4. Health check: GET /api/health
   5. App available on Railway URL
   ```

### ğŸ§ª Verified Working Features

âœ… **Frontend Build**: `cd client && npm install && npm run build`  
âœ… **Static Serving**: Express serves `client/dist/` files  
âœ… **SPA Routing**: All routes serve `index.html` (except /api/*)  
âœ… **API Endpoints**: `/api/health` and `/api/test` working  
âœ… **Health Check**: Railway monitors `/api/health`  
âœ… **Production Ready**: Optimized Vite build with code splitting  

### ğŸ” Testing Locally

```bash
# Test the Railway setup locally
cp package-heroku.json package.json
npm run postinstall  # Builds frontend
npm start            # Starts production server

# Test endpoints
curl http://localhost:3000/api/health
curl http://localhost:3000/          # React app
curl http://localhost:3000/dashboard  # SPA routing
```

### ğŸ¯ Railway Deployment URLs

After deployment, your app will be available at:
- **App**: `https://your-app.railway.app`
- **Health**: `https://your-app.railway.app/api/health`
- **Test**: `https://your-app.railway.app/api/test`

### ğŸ› ï¸ Troubleshooting

**Build Issues**:
- Ensure `client/package.json` has all dependencies
- Check build logs in Railway dashboard

**Serving Issues**:
- Verify `client/dist/` exists after build
- Check Express static path: `../client/dist`

**Environment**:
- Railway sets `NODE_ENV=production` automatically
- Express defaults to port 3000, Railway overrides with PORT env var

### ğŸ“‹ Deployment Checklist

- âœ… `postinstall` script builds frontend
- âœ… `start` script runs Express server
- âœ… Express serves static files from `client/dist/`
- âœ… SPA fallback serves `index.html` for all non-API routes
- âœ… Health check endpoint at `/api/health`
- âœ… Railway configuration in `railway.toml`
- âœ… Production-optimized Vite build

**Your app is ready for Railway deployment! ğŸš‚**