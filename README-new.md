# Vite + Express Fullstack

A complete fullstack JavaScript application with **Vite + React** frontend and **Express.js** backend, specifically structured for Railway deployment.

## 📁 Project Structure

```
/
├── app.cjs               # Express server (CommonJS, port 8080)
├── client/               # Vite + React frontend
│   ├── src/
│   │   ├── App.jsx      # Main React component
│   │   ├── main.jsx     # React entry point
│   │   └── index.css    # Global styles
│   ├── dist/            # Built frontend files (generated by build)
│   ├── package.json     # Client dependencies
│   └── vite.config.js   # Vite configuration with proxy
├── package-new.json     # Production package.json
├── railway.toml         # Railway deployment config
├── Procfile             # Railway process file
└── README.md            # This file
```

## ✨ Key Features

- **Express Backend**: Serves static files from `client/dist` with SPA fallback
- **Vite Frontend**: Modern React app with hot module replacement
- **Railway Ready**: Zero-config deployment with health monitoring
- **SPA Support**: Fallback route serves `index.html` for client-side routing
- **Development**: Concurrent dev servers with API proxy

## 🔗 API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET`  | `/api/health` | Server health check |
| `GET`  | `/*` | Serves React app (SPA fallback) |

## 🛠️ Development

```bash
# Install dependencies (both root and client)
npm install
cd client && npm install && cd ..

# Start development servers (concurrently)
npm run dev
# This starts:
# - Express server on port 8080
# - Vite dev server on port 5173 (with API proxy)

# Build frontend only
npm run build

# Start production server
npm start

# Build and start (production workflow)
npm run build:start
```

## 🚀 Production Build Process

The build script performs these steps:
1. `cd client && npm run build` - Builds Vite app to `client/dist`
2. Express serves static files from `client/dist`
3. Fallback route (`app.get('*')`) serves `index.html` for SPA routing

## 🚂 Railway Deployment

### Method 1: GitHub Integration (Recommended)

1. **Replace package.json**:
   ```bash
   cp package-new.json package.json
   ```

2. **Create GitHub repository**:
   ```bash
   git init
   git add .
   git commit -m "Vite + Express fullstack app"
   git branch -M main
   git remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO.git
   git push -u origin main
   ```

3. **Deploy on Railway**:
   - Connect your GitHub repository
   - Railway will automatically:
     - Install dependencies
     - Build the frontend (`cd client && npm run build`)
     - Start the server (`node app.cjs`)

### Method 2: Railway CLI

```bash
# Install Railway CLI
npm install -g @railway/cli

# Deploy directly
railway login
railway init
railway up
```

## ⚙️ Configuration Details

### Express Server (`app.cjs`)
```javascript
// Serve static files
app.use(express.static(path.join(__dirname, 'client/dist')));

// SPA fallback - serve index.html for all non-API routes
app.get('*', (req, res) => {
  res.sendFile(path.join(__dirname, 'client/dist/index.html'));
});
```

### Vite Config (`client/vite.config.js`)
```javascript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:8080',
      changeOrigin: true,
    },
  },
}
```

### Railway Config (`railway.toml`)
```toml
[deploy]
startCommand = "node app.cjs"
healthcheckPath = "/api/health"
```

## 🧪 Testing

### Local Testing
```bash
# Build and test production setup
npm run build:start

# Test API
curl http://localhost:8080/api/health

# Test static serving and SPA fallback
curl http://localhost:8080/
curl http://localhost:8080/any-route  # Should serve index.html
```

### Production Testing
After Railway deployment:
```bash
curl https://your-app.railway.app/api/health
```

Expected response:
```json
{
  "status": "OK",
  "timestamp": "2025-01-28T...",
  "environment": "production"
}
```

## 🎯 Architecture Compliance

✅ **Frontend in `/client`** - Vite + React setup  
✅ **Backend in root** - Express.js server  
✅ **Static File Serving** - `express.static(client/dist)`  
✅ **SPA Fallback** - `app.get('*')` serves `index.html`  
✅ **Build Script** - Builds frontend then starts backend  
✅ **Railway Ready** - Health check and port configuration  

## 🌐 Live Application

After deployment, your application will be available at:
- **App**: `https://your-app.railway.app`
- **Health**: `https://your-app.railway.app/api/health`

The Express server serves the built Vite files and handles SPA routing perfectly!