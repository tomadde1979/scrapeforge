# Railway Deployment Guide

## ✅ Railway-Ready Full-Stack App

Your full-stack Vite + Express app is now configured for Railway deployment with automatic frontend building and proper static file serving.

### 📁 Project Structure
```
/
├── package-heroku.json       # Railway deployment package.json
├── railway.toml             # Railway configuration
├── server/
│   └── index.cjs           # Express server with static serving + SPA routing
├── client/                 # React + Vite app
│   ├── dist/              # Built files (auto-generated by Railway)
│   └── vite.config.js     # Optimized build configuration
└── RAILWAY_DEPLOYMENT_GUIDE.md
```

### 🚀 Key Configuration Changes

#### 1. Root package.json (package-heroku.json)
```json
{
  "scripts": {
    "postinstall": "cd client && npm install && npm run build",
    "start": "node server/index.cjs"
  }
}
```

#### 2. Express Server (server/index.cjs)
```javascript
const clientDistPath = path.join(__dirname, '../client/dist');

// Static file serving
app.use(express.static(clientDistPath));

// SPA routing fallback
app.get('*', (req, res) => {
  if (req.path.startsWith('/api')) {
    return res.status(404).json({ message: 'API endpoint not found' });
  }
  res.sendFile(path.join(clientDistPath, 'index.html'));
});
```

#### 3. Railway Configuration (railway.toml)
```toml
[deploy]
startCommand = "npm start"
healthcheckPath = "/api/health"

[env]
NODE_ENV = "production"
```

### 🔄 Railway Deployment Process

1. **Copy deployment package.json**:
   ```bash
   cp package-heroku.json package.json
   ```

2. **Deploy to Railway**:
   - Connect your GitHub repository to Railway
   - Railway automatically:
     - Runs `npm install` (installs root dependencies)
     - Runs `postinstall` script: `cd client && npm install && npm run build`
     - Starts app: `node server/index.cjs`

3. **What happens during deployment**:
   ```
   1. Railway installs root dependencies (express)
   2. postinstall runs: builds React app to client/dist/
   3. Express server starts and serves built files
   4. Health check: GET /api/health
   5. App available on Railway URL
   ```

### 🧪 Verified Working Features

✅ **Frontend Build**: `cd client && npm install && npm run build`  
✅ **Static Serving**: Express serves `client/dist/` files  
✅ **SPA Routing**: All routes serve `index.html` (except /api/*)  
✅ **API Endpoints**: `/api/health` and `/api/test` working  
✅ **Health Check**: Railway monitors `/api/health`  
✅ **Production Ready**: Optimized Vite build with code splitting  

### 🔍 Testing Locally

```bash
# Test the Railway setup locally
cp package-heroku.json package.json
npm run postinstall  # Builds frontend
npm start            # Starts production server

# Test endpoints
curl http://localhost:3000/api/health
curl http://localhost:3000/          # React app
curl http://localhost:3000/dashboard  # SPA routing
```

### 🎯 Railway Deployment URLs

After deployment, your app will be available at:
- **App**: `https://your-app.railway.app`
- **Health**: `https://your-app.railway.app/api/health`
- **Test**: `https://your-app.railway.app/api/test`

### 🛠️ Troubleshooting

**Build Issues**:
- Ensure `client/package.json` has all dependencies
- Check build logs in Railway dashboard

**Serving Issues**:
- Verify `client/dist/` exists after build
- Check Express static path: `../client/dist`

**Environment**:
- Railway sets `NODE_ENV=production` automatically
- Express defaults to port 3000, Railway overrides with PORT env var

### 📋 Deployment Checklist

- ✅ `postinstall` script builds frontend
- ✅ `start` script runs Express server
- ✅ Express serves static files from `client/dist/`
- ✅ SPA fallback serves `index.html` for all non-API routes
- ✅ Health check endpoint at `/api/health`
- ✅ Railway configuration in `railway.toml`
- ✅ Production-optimized Vite build

**Your app is ready for Railway deployment! 🚂**